void RESET_TRAO_THE_SX();
void RESET_SHAGAI2_SX();
void RESET_SHAGAI3_SX();

void chuong_trinh_chay_san_xanh()/////CHAY_TU_DONG_THEO_LAZE_1
{	
	if(VUONG==0)
		{		
				Robot_Stop_Now(0);
			
				run_read_gyro_uart1();
			
				RESET_ENCODER(3);
				
				while( abs(READ_ENCODER(3))<5500) 
				{
					if(O==0) break;
					MAIN_CONTROL(0,-475,100,0.1,0);
					vTaskDelay(10);
					GPIO_ToggleBits(GPIOD,GPIO_Pin_7);	
				}
							while( abs(READ_ENCODER(3))<7200) 
				{
					if(O==0) break;
					MAIN_CONTROL(0,-475,80,0.1,0);
					vTaskDelay(10);
					GPIO_ToggleBits(GPIOD,GPIO_Pin_7);	
				}
//				////////////////////////////////////////////	lenCot 1

							while( (abs(READ_ENCODER(3))<12500) )
				{
				///	if((ADC1_Value_1>180)&&(ADC1_Value_1<195))break;
					if(O==0)break;
					MAIN_CONTROL(0,0,80,0.1,0);
					vTaskDelay(10);
					GPIO_ToggleBits(GPIOD,GPIO_Pin_7);	
				}
//				///////////////////////////////////////////
			while(abs(READ_ENCODER(3))<21550)
				{
					if(O==0)break;		
					MAIN_CONTROL(0,470,80,0.1,0);
					vTaskDelay(1);
					GPIO_ToggleBits(GPIOD,GPIO_Pin_7);	
				}
				//////////////////////////////////////////// lenCot 2
			while(abs(READ_ENCODER(3))<28400)
				{
					//if((ADC1_Value_1<127)&&(ADC1_Value_1>110))break;
					if(O==0)break;
					MAIN_CONTROL(35,0,80,0.1,0);
					vTaskDelay(1);
					GPIO_ToggleBits(GPIOD,GPIO_Pin_7);	
				}
				while(abs(READ_ENCODER(3))<38000)
				{
					//if((ADC1_Value_1<150)&&(ADC1_Value_1>130))break;
					if(O==0)break;
					MAIN_CONTROL(0,-470,80,0.1,0);
					vTaskDelay(1);
					GPIO_ToggleBits(GPIOD,GPIO_Pin_7);	
				}
//				//////////////////////////////////////////// 		lenCot 3
			while( abs(READ_ENCODER(3))<44400)
				{			
					if(O==0)break;
					MAIN_CONTROL(0,0,80,0.1,0);
					vTaskDelay(1);
					GPIO_ToggleBits(GPIOD,GPIO_Pin_7);	
				}
			///////////////////////////////////////// Chay_cheo_Cuoi
			vTaskDelay(20);
				///////////////////////////////////////	Neu_Thoat_Thi_Tiep_Tuc_Chay_Theo_ENCODER
				while( abs(READ_ENCODER(3))<49800)
				{
					if(O==0)break;
					if(CB_QUANG==0) break;
					MAIN_CONTROL(0,300,80,0.1,0);
					vTaskDelay(1);
					GPIO_ToggleBits(GPIOD,GPIO_Pin_7);	
				}
				vTaskDelay(1475);
				///////////////////////////////////////////// 			qua cau
				while(abs(READ_ENCODER(3))<76000)
				{
					if(ADC1_Value_1<205)break;
					if(O==0)break;
					MAIN_CONTROL(0,0,80,0.1,0);
					vTaskDelay(1);
					GPIO_ToggleBits(GPIOD,GPIO_Pin_7);	
				}

         /////////////////////////////////////////////////////// sang ngang
						RESET_ENCODER(2);
           
            while(abs(READ_ENCODER(2))<20000)
            {
               if(O==0)break;
               MAIN_CONTROL(0,-900+CHAY_TU_DONG_THEO_LAZE_1(1,215,5),80,0.1,0);
               vTaskDelay(1);
               GPIO_ToggleBits(GPIOD,GPIO_Pin_7);   
            }
            while(abs(READ_ENCODER(2))<30000)
            {
               if(O==0)break;
               MAIN_CONTROL(0,-900,60,0.1,0);
               vTaskDelay(1);
               GPIO_ToggleBits(GPIOD,GPIO_Pin_7);   
            }
						            while(abs(READ_ENCODER(2))<43000)
            {
               if(O==0)break;
               if(CB_QUANG==0)break;
               MAIN_CONTROL(0,-900,60,0.1,0);
               vTaskDelay(1);
               GPIO_ToggleBits(GPIOD,GPIO_Pin_7);   
            }

				 RESET_ENCODER(3);
				 while(abs(READ_ENCODER(3))<200)
				{
					if(O==0)break;
					MAIN_CONTROL(0,1800,10,0.1,0);
					vTaskDelay(1);
					GPIO_ToggleBits(GPIOD,GPIO_Pin_7);	
				}
				MAIN_CONTROL(0,1800,10,0.1,0);
				vTaskDelay(3000);
				RESET_ENCODER(2);
         while(abs(READ_ENCODER(2))<12000)
         {
            if(O==0)break;
            MAIN_CONTROL(0,-900,20,0.1,0);
            vTaskDelay(1);
            GPIO_ToggleBits(GPIOD,GPIO_Pin_7);
         }
				 MAIN_CONTROL(0,1800,10,0.1,0);
				vTaskDelay(4000);
					MAIN_CONTROL(0,0,0,1,0);
				 ////////////////////////////////////// XOAY_NONG_RA_TRUOC
				 while(VR1<380)
					{
						DC_XOAY_NONG_SAU;
						DC_XOAY_NONG=15;
					}
					DC_XOAY_NONG=0;
					vTaskDelay(1000);
					/////////////// NHA~_THE
						GPIO_WriteBit(GPIOA,GPIO_Pin_4,1);
					vTaskDelay(20000);//// TIME_CHO_TRAO_THE
					GPIO_WriteBit(GPIOA,GPIO_Pin_4,0);/////////// OPEN_TAY_KEP_SHAGAI
					vTaskDelay(2000);
					vTaskDelay(1);
					RESET_ENCODER(2);
         while(ADC1_Value_1>150)
         {
            if(O==0)break;
            MAIN_CONTROL(0,900,20,0.1,0);
            vTaskDelay(1);
            GPIO_ToggleBits(GPIOD,GPIO_Pin_7);
         }
				 MAIN_CONTROL(0,900,0,0.1,0);
		///////////////////////////////////////////////
				while(HT_XOAY_TRUOC==1)
				{
					DC_XOAY_NONG_TRUOC;
					DC_XOAY_NONG=50;
					vTaskDelay(1);
				}		
				vTaskDelay(10000);
				//////// DINH_VI_SHAGAI
				RESET_ENCODER(3);
				while(abs(READ_ENCODER(3))<4000) 
				{
					if(O==0)break;
						if(ADC1_Value_1<1)chong_nhieu++;
						else chong_nhieu=0;
						if(chong_nhieu>300) break;
					MAIN_CONTROL(0,0,30,0.1,0);
					GPIO_ToggleBits(GPIOD,GPIO_Pin_7);
					vTaskDelay(1);
				}
				////////////////////////////////////// KICH_XILANH_KEP
				MAIN_CONTROL(0,0,0,0.1,0);
				vTaskDelay(1);
				if(O!=0)
					{
						MAIN_CONTROL(0,900,30,0.1,0);//delay
						vTaskDelay(1000);
						GPIO_WriteBit(GPIOA,GPIO_Pin_4,1);//kep
						vTaskDelay(500);
					}
				else MAIN_CONTROL(0,0,0,0.1,0);
				///////////////////////////////////////// XOAY_NONG_RA_SAU
				if(O==0)	DC_XOAY_NONG=2;
				else 
				{
					while(VR1<300)
						{
							DC_XOAY_NONG_SAU;
							DC_XOAY_NONG=40;
							vTaskDelay(1);
						}				
				}
				DC_XOAY_NONG=0;
				vTaskDelay(1);
				//////////////////////////////////////////// Chay_Ngang_Vung_Ban
				RESET_ENCODER(2);
				while(abs(READ_ENCODER(2))<1000) 
				{
					if(O==0)break;
					MAIN_CONTROL(0,900,30,0.1,0);
					vTaskDelay(1);
				}
			MAIN_CONTROL(0,0,0,0.1,0);
				//////////////////////////////////
		
		vTaskDelay(1);
		while(1)
			{		
				if(VUONG==0)
					{
							Robot_Stop_Now(0);			
						//	run_read_gyro_uart1();
							if(O==0)	DC_XOAY_NONG=0;
							else 
							{
										DC_XOAY_NONG_SAU;
										DC_XOAY_NONG=50;
										vTaskDelay(1);
							}
							///////////////////////////////////////// CHAY_VAO_VUNG_BAN
							RESET_ENCODER(3);
							while(abs(READ_ENCODER(3))<5500)
							{
								if(O==0)break;
								MAIN_CONTROL(50,1800,80,0.1,0);
							}
							while(abs(READ_ENCODER(3))<36500)
							{
								if(O==0)break;
								if(CB_QUANG==0)break;
								MAIN_CONTROL(0,1800-CHAY_TU_DONG_THEO_LAZE_0(1,55,5),80,0.1,0);
								vTaskDelay(1);
							}
							RESET_ENCODER(3);
							vTaskDelay(1);
							while(abs(READ_ENCODER(3))<2000)
							{
								if(O==0)break;
								MAIN_CONTROL(220,1800,20,0.05,3);//170
								vTaskDelay(1);		
							} 
							MAIN_CONTROL(220,1800,10,0.05,0);
							vTaskDelay(20000);						
							MAIN_CONTROL(0,0,2,0.1,0);
						
							////////////////////////////////Kich_Xi_Lanh
							if(O==0)
							{
							GPIO_WriteBit(GPIOB,GPIO_Pin_12,0);
								vTaskDelay(1);
							GPIO_WriteBit(GPIOB,GPIO_Pin_13,0);	
								vTaskDelay(1);
							GPIO_WriteBit(GPIOA,GPIO_Pin_4,0);
								vTaskDelay(1);
							GPIO_WriteBit(GPIOA,GPIO_Pin_5,0);
								vTaskDelay(1);
							}
							else	Kich_Xi_Lanh();
							vTaskDelay(1);	
				/*~~~~~~~~~~~~ GAP_ XI LANH_2~~~~~~~~~~*/			

				////////////////////////////////////// XOAY_NONG_RA_TRUOC
							MAIN_CONTROL(0,0,0,0.1,0);
							vTaskDelay(1);	
							if(O==0) DC_XOAY_NONG=2;			
							else
							{
								DC_XOAY_NONG_TRUOC;
								DC_XOAY_NONG=70;
								vTaskDelay(10000);
							}				
								///////////////////////////// CT_ Kep Shagai 2////////////////////////////////////////////////////////////////////////////////////////////
								while(abs(READ_ENCODER(3))<25000)
								{
									if(O==0)break;
								MAIN_CONTROL(-25,0-CHAY_TU_DONG_THEO_LAZE_0(-1,55,10),60,0.1,0);
									vTaskDelay(1);
								}
								while(abs(READ_ENCODER(3))<35000)
								{
									if(ADC1_Value_1 <200) break;
									if(O==0)break;
								MAIN_CONTROL(-25,0,60,0.1,0);
									vTaskDelay(1);
								}
								RESET_ENCODER(2);
								while(abs(READ_ENCODER(2))<5500)
								{
									if(O==0)break;
									if(ADC1_Value_1 <130) break;
									MAIN_CONTROL(-25,900,40,0.1,0);
									vTaskDelay(1);
									GPIO_ToggleBits(GPIOD,GPIO_Pin_7);	
								}
								//////////////////////////Dinh_vi_ShaGai
								vTaskDelay(1);
								RESET_ENCODER(3);
								chong_nhieu=0;
								while(abs(READ_ENCODER(3))<3500)
								{
									if(ADC1_Value_1<1)chong_nhieu++;
										else chong_nhieu=0;
										if(chong_nhieu>300) break;
									if(O==0)break;
								MAIN_CONTROL(0,0,30,0.1,0);
									vTaskDelay(1);
								}
								MAIN_CONTROL(0,0,0,0.1,0);
								vTaskDelay(1);
								////////////////////////////////////// KICH_XL_KEP SHAGAI_2
									if(O!=0)
									{
										MAIN_CONTROL(0,900,15,0.1,0);//delay
										vTaskDelay(2500);
										MAIN_CONTROL(0,900,0,0.1,0);
										GPIO_WriteBit(GPIOA,GPIO_Pin_4,1);//kep
										vTaskDelay(500);
									}
									else MAIN_CONTROL(0,0,0,0.1,0);
								//////////////////////////////////////// XOAY_NONG_RA_SAU/-----------------/ Lan 2
								if(O==0)	DC_XOAY_NONG=0;
								else 
								{
									DC_XOAY_NONG_SAU;
									DC_XOAY_NONG=40;
									vTaskDelay(1);		
								}
								vTaskDelay(5000);
//								RESET_ENCODER(2);
//								while(abs(READ_ENCODER(2))<200)
//								{
//									if(O==0)break;
//									MAIN_CONTROL(0,-900,80,0.1,0);
//									vTaskDelay(1);
//									GPIO_ToggleBits(GPIOD,GPIO_Pin_7);	
//								}
								/////////////////////////////////////// CHAY_VAO_VUNG_BAN_LAN_2
								RESET_ENCODER(3);
								while(abs(READ_ENCODER(3))<10000)		
								{
									if(O==0)break;
								MAIN_CONTROL(0,1800,80,0.1,0);
									vTaskDelay(1);
								}
								//////////////////////////////////////////// START_LAZE_LAN_2
								while(abs(READ_ENCODER(3))<38500)
								{
									if(O==0)break;
									if(CB_QUANG==0)break;
									MAIN_CONTROL(0,1800-CHAY_TU_DONG_THEO_LAZE_0(1,55,5),80,0.1,0);
									vTaskDelay(1);
								}
								RESET_ENCODER(3);
								vTaskDelay(1);
								while(abs(READ_ENCODER(3))<2000)
								{
									if(O==0)break;
									MAIN_CONTROL(350,1800,20,0.05,3);
									vTaskDelay(1);
								}
								MAIN_CONTROL(350,1800,10,0.05,0);
								vTaskDelay(25000);
								MAIN_CONTROL(0,0,0,0.1,3);
								
									if(O==0)
									{
										GPIO_WriteBit(GPIOB,GPIO_Pin_12,0);
											vTaskDelay(1);
										GPIO_WriteBit(GPIOB,GPIO_Pin_13,0);	
											vTaskDelay(1);
										GPIO_WriteBit(GPIOA,GPIO_Pin_4,0);
											vTaskDelay(1);
										GPIO_WriteBit(GPIOA,GPIO_Pin_5,0);
											vTaskDelay(1);
									}
									else	Kich_Xi_Lanh();
								
								/*~~~~~~~~~~~~~~~~``KEP_SHAGAI_LAN_3~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~``*/

								////////////////////////////// XOAY_NONG_RA_TRUOC/
								MAIN_CONTROL(0,0,0,0.1,0);
									vTaskDelay(1);
								if(O==0) DC_XOAY_NONG=0;			
								else
								{
									DC_XOAY_NONG_TRUOC;
									DC_XOAY_NONG=70;
									vTaskDelay(10000);
								}		
								///////////////////////////// CT_ Kep Shagai 3
								while(abs(READ_ENCODER(3))<20000)
								{
									if(O==0)break;
								MAIN_CONTROL(-25,0-CHAY_TU_DONG_THEO_LAZE_0(-1
									,50,10),60,0.1,0);
									vTaskDelay(1);
								}
								while(abs(READ_ENCODER(3))<35000)
								{
									if(ADC1_Value_1 <200) break;
									if(O==0)break;
								MAIN_CONTROL(-25,0,60,0.1,0);
									vTaskDelay(1);
								}
								RESET_ENCODER(2);
								vTaskDelay(1);
								while(abs(READ_ENCODER(2))<13000)
								{
									if(O==0)break;
									if(ADC1_Value_1 <130) break;
									MAIN_CONTROL(-25,900,40,0.1,0);
									vTaskDelay(1);
									GPIO_ToggleBits(GPIOD,GPIO_Pin_7);	
								}
								
								RESET_ENCODER(3);
								vTaskDelay(1);
								chong_nhieu=0;
								while(abs(READ_ENCODER(3))<3500)		
								{
									if(ADC1_Value_1<1)chong_nhieu++;
									else chong_nhieu=0;
									if(chong_nhieu>300) break;
									if(O==0)break;
									MAIN_CONTROL(0,0,30,0.1,0);
									vTaskDelay(1);
								}
								MAIN_CONTROL(0,0,0,0.1,0);
								////////////////////////////////////// KICH_XL_KEP SHAGAI_3
									if(O!=0)
									{
										MAIN_CONTROL(0,900,15,0.1,0);//delay
										vTaskDelay(2000);
										MAIN_CONTROL(0,900,0,0.1,0);
										GPIO_WriteBit(GPIOA,GPIO_Pin_4,1);//kep
										vTaskDelay(500);
									}
									else MAIN_CONTROL(0,0,0,0.1,0);
								RESET_ENCODER(2);
								while(abs(READ_ENCODER(2))<500)
								{
									if(O==0)break;
									MAIN_CONTROL(0,-900,30,0.1,0);
									vTaskDelay(1);
									GPIO_ToggleBits(GPIOD,GPIO_Pin_7);	
								}
								//////////////////////////////////////// XOAY_NONG_RA_SAU/-----------------/ Lan 3
								if(O==0)	DC_XOAY_NONG=0;
								else 
								{
									DC_XOAY_NONG_SAU;
									DC_XOAY_NONG=40;
									vTaskDelay(10000);
								}
								/////////////////////////////////////// CHAY_VAO_VUNG_BAN_LAN_3
								RESET_ENCODER(3);
								while(abs(READ_ENCODER(3))<11000)		
								{
									if(O==0)break;
									MAIN_CONTROL(0,1800,80,0.1,0);
									vTaskDelay(1);
								}
								//////////////////////////////////////////// START_LAZE
								while(abs(READ_ENCODER(3))<38500)
								{
									if(O==0)break;
									if(CB_QUANG==0)break;
									MAIN_CONTROL(0,1800-CHAY_TU_DONG_THEO_LAZE_0(1,50,5),80,0.1,0);
									vTaskDelay(1);
								}
								RESET_ENCODER(3);
								vTaskDelay(1);
								while(abs(READ_ENCODER(3))<2000)
								{
									if(O==0)break;
									MAIN_CONTROL(450,1800,20,0.1,3);
									vTaskDelay(1);
								} 			
								MAIN_CONTROL(450,1800,10,0.05,0);
								vTaskDelay(20000);
								MAIN_CONTROL(0,0,2,0.1,3);
								/////KICH_XL
								if(O==0)
								{
									GPIO_WriteBit(GPIOB,GPIO_Pin_12,0);
										vTaskDelay(1);
									GPIO_WriteBit(GPIOB,GPIO_Pin_13,0);	
										vTaskDelay(1);
									GPIO_WriteBit(GPIOA,GPIO_Pin_4,0);
										vTaskDelay(1);
									GPIO_WriteBit(GPIOA,GPIO_Pin_5,0);
										vTaskDelay(1);
								}
								else	Kich_Xi_Lanh();	
							}
						MAIN_CONTROL(0,0,0,0.1,0);				
				}
			}
			if(X==0)
			{
				while(1)
				{
					if(O==0) break;
					RESET_TRAO_THE_SX();
					RESET_SHAGAI2_SX();
					RESET_SHAGAI3_SX();
				}
			}
	MAIN_CONTROL(0,0,0,0.1,0);
}
/////////////////////////////////////////////////////RETRY_TRAO_THE_SAN_XANH
void RESET_TRAO_THE_SX()
{
	while(R2==0)
	{
		if(O==0) break;
		while(VR1<380)
			{
				if(0) break;
				DC_XOAY_NONG_SAU;
				DC_XOAY_NONG=15;
				vTaskDelay(1);
				GPIO_ToggleBits(GPIOD,GPIO_Pin_7);
			}
		DC_XOAY_NONG=0;
		vTaskDelay(1000);
		////////////////////////////////////////////////////////////// NHA~_THE
		GPIO_WriteBit(GPIOA,GPIO_Pin_4,1);
		vTaskDelay(20000);//////////////////////////////////////////// TIME_CHO_TRAO_THE
		GPIO_WriteBit(GPIOA,GPIO_Pin_4,0);/////////////////////////// OPEN_TAY_KEP_SHAGAI
		while(VR1>320)
			{
				if(0) break;
				DC_XOAY_NONG_TRUOC;
				DC_XOAY_NONG=40;
				vTaskDelay(1);
				GPIO_ToggleBits(GPIOD,GPIO_Pin_7);
			}
			DC_XOAY_NONG=0;
	}
}
//////////////////////////////////////////////////// RETRY_SHAGAI2_SAN_XANH
void RESET_SHAGAI2_SX()
{
	while(L1==0)
	{
		if(O==0)break;
		Robot_Stop_Now(0);			
		run_read_gyro_uart1();
		RESET_ENCODER(2);
		while(abs(READ_ENCODER(2))<30000)
		{
			if(O==0)break;
			if(ADC1_Value_1 <130) break;
			MAIN_CONTROL(-25,900,30,0.1,0);
			vTaskDelay(1);
			GPIO_ToggleBits(GPIOD,GPIO_Pin_7);	
		}
		MAIN_CONTROL(0,0,0,0.1,0);
	}
}
//////////////////////////////////////////////////// RETRY_SHAGAI3_SAN_XANH

void RESET_SHAGAI3_SX()
{
	while(L2==0)
	{
		if(O==0)break;
		Robot_Stop_Now(0);			
		run_read_gyro_uart1();
		RESET_ENCODER(2);
		while(abs(READ_ENCODER(2))<40000)
		{
			if(O==0)break;
			if(ADC1_Value_1 <130) break;
			MAIN_CONTROL(-25,900,30,0.1,0);
			vTaskDelay(1);
			GPIO_ToggleBits(GPIOD,GPIO_Pin_7);	
		}
		MAIN_CONTROL(0,0,0,0.1,0);
	}
}




